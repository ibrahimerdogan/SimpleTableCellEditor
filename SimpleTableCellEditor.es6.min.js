"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}window.onload=function(){if(!window.jQuery)throw"jQuery is not loaded"};var SimpleTableCellEdition=function a(b,c){_classCallCheck(this,a),this.Elem=b,this.oldContent=$(b).html(),this.oldValue=c.internals.extractValue(b),this.cellParams=c},SimpleTableCellEditor=function(){function a(b,c){_classCallCheck(this,a);var d=this;"undefined"==typeof b&&(b="table"),this.tableId=b,this.params=d._GetExtendedEditorParams(c),this.CellEdition=null,this._TryHandleDataTableReloadEvent(),$(document).mouseup(function(f){var g=$("#"+d.tableId);g.is(f.target)||0!==g.has(f.target).length||d._FreeCurrentCell()})}return _createClass(a,[{key:"SetEditable",value:function SetEditable(b,c){var d=this;if(d._isValidElem(b)){var f=d._GetExtendedCellParams(c);$(b).on("click",function(){$(this).hasClass(d.params.inEditClass)||d._EditCell(this,f)}),$(b).on("keydown",function(g){$(this).hasClass(d.params.inEditClass)&&d._HandleKeyPressed(g.which,this,f)})}}},{key:"SetEditableClass",value:function SetEditableClass(b,c){var d=this,f=d._GetExtendedCellParams(c);$("#"+this.tableId).on("click","td."+b+":not(."+d.params.inEditClass+")",function(){d._EditCell(this,f)}),$("#"+this.tableId).on("keydown","td."+b+"."+d.params.inEditClass,function(g){d._HandleKeyPressed(g.which,this,f)})}},{key:"_HandleKeyPressed",value:function _HandleKeyPressed(b,c,d){d.keys.validation.includes(b)?this._EndEditCell(c,d):d.keys.cancellation.includes(b)&&this._CancelEditCell(c,d)}},{key:"_EditCell",value:function _EditCell(b,c){this._FreeCurrentCell(),this.CellEdition=new SimpleTableCellEdition(b,c),this.isDataTable&&(this.CellEdition.cellIndex=$("#"+this.tableId).DataTable().cell($(b)).index());var d=c.internals.extractValue(b);$(b).addClass(this.params.inEditClass),c.internals.renderEditor(b,d),this._FireOnEditEnterEvent(b,d)}},{key:"_EndEditCell",value:function _EndEditCell(b,c){this._FreeCell(b,c,!0)}},{key:"_CancelEditCell",value:function _CancelEditCell(b,c){this._FreeCell(b,c,!1)}},{key:"_FreeCell",value:function _FreeCell(b,c,d){if(this._isValidElem(b)&&null!==this.CellEdition){var f=c.internals.extractEditorValue(b);$(b).removeClass(this.params.inEditClass),$(b).html("");var g=c.formatter(f);c.validation(f)&&this.CellEdition.oldValue!==g||(d=!1),this._FireOnEditExitEvent(b,this.CellEdition.oldValue,g,d),d?(c.internals.renderValue(b,g),this._FireEditedEvent(b,this.CellEdition.oldValue,g)):$(b).html(this.CellEdition.oldContent),this.CellEdition=null}}},{key:"_FreeCurrentCell",value:function _FreeCurrentCell(){var b=this._GetCurrentEdition();null===b||this._EndEditCell(b.Elem,b.cellParams)}},{key:"_GetCurrentEdition",value:function _GetCurrentEdition(){return null===this.CellEdition?null:this.CellEdition}},{key:"_GetExtendedEditorParams",value:function _GetExtendedEditorParams(b){var c=this;return $.extend(!0,{},c._GetDefaultEditorParams(),b)}},{key:"_GetExtendedCellParams",value:function _GetExtendedCellParams(b){var c=this;return $.extend(!0,{},c._GetDefaultCellParams(),b)}},{key:"_GetDefaultEditorParams",value:function _GetDefaultEditorParams(){return{inEditClass:"inEdit"}}},{key:"_GetDefaultCellParams",value:function _GetDefaultCellParams(){return{validation:function validation(){return!0},formatter:function formatter(b){return b},keys:{validation:[13],cancellation:[27]},internals:this._GetDefaultInternals()}}},{key:"_GetDefaultInternals",value:function _GetDefaultInternals(){return{renderValue:function renderValue(b,c){$(b).text(c)},renderEditor:function renderEditor(b,c){$(b).html("<input type='text' style=\"width:100%; max-width:none\">");var d=$(b).find("input");d.focus(),d.val(c)},extractEditorValue:function extractEditorValue(b){return $(b).find("input").val()},extractValue:function extractValue(b){return $(b).text()}}}},{key:"_FireOnEditEnterEvent",value:function _FireOnEditEnterEvent(b,c){$("#"+this.tableId).trigger({type:"cell:onEditEnter",element:b,oldValue:c})}},{key:"_FireOnEditExitEvent",value:function _FireOnEditExitEvent(b,c,d,f){$("#"+this.tableId).trigger({type:"cell:onEditExit",element:b,newValue:d,oldValue:c,applied:f})}},{key:"_FireEditedEvent",value:function _FireEditedEvent(b,c,d){$("#"+this.tableId).trigger({type:"cell:edited",element:b,newValue:d,oldValue:c})}},{key:"_TryHandleDataTableReloadEvent",value:function _TryHandleDataTableReloadEvent(){var b=this;this.isDataTable=!1;try{$.fn.DataTable.isDataTable("#"+b.tableId)&&(b.isDataTable=!0)}catch(c){return}b.isDataTable&&$("#"+b.tableId).on("draw.dt",function(){if(null!==b.CellEdition&&null!==b.CellEdition.Elem){var c=$("#"+b.tableId).DataTable().cell(b.CellEdition.cellIndex).node();b._EditCell(c,b.CellEdition.cellParams)}})}},{key:"_isValidElem",value:function _isValidElem(b){return null!==b&&"undefined"!=typeof b&&0<$(b).length}}]),a}();